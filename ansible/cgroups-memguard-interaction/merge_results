#!/bin/bash

echo "container,mem_period,mem_bw,cpu_quota,cpu_period,repetition,benchmark,class,result" > alltests.csv

for f in tests/* ; do
  n=`basename $f`
  container=`echo  $n | sed -n 's/\(.*\)_.*_.*_.*_.*_.*\.json/\1/p'`
  mem_period=`echo $n | sed -n 's/.*_\(.*\)_.*_.*_.*_.*\.json/\1/p'`
  mem_bw=`echo     $n | sed -n 's/.*_.*_\(.*\)_.*_.*_.*\.json/\1/p'`
  cpu_quota=`echo  $n | sed -n 's/.*_.*_.*_\(.*\)_.*_.*\.json/\1/p'`
  cpu_period=`echo $n | sed -n 's/.*_.*_.*_.*_\(.*\)_.*\.json/\1/p'`
  repetition=`echo $n | sed -n 's/.*_.*_.*_.*_.*_\(.*\)\.json/\1/p'`
  jq -r --arg n $n --arg c $container --arg m $mem_period --arg b $mem_bw --arg q $cpu_quota --arg p $cpu_period --arg r $repetition '.[] | [$c, $m, $b, $q, $p, $r, .name, .class, .result] | @csv' $f >> alltests.csv
done

sed -i -e 's/\.json//' alltests.csv
